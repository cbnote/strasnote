function getHash(){return window.location.hash.replace("#","")}function setupAnchors(){$("body").on("click","a",function(n){var t=$(this).attr("href"),i;t.startsWith("https")||t!="javascript:void(0)"&&(n.preventDefault(),i=$(this).data("target"),i?load(t,$(i)):updateHash(t))})}function setupHashChange(){window.onhashchange=loadHash}function loadHash(){var n=getHash();n&&n.length!=1||(n=homeUrl);load(n,$("main"))}function updateHash(n){getHash()==n?loadHash():window.location.hash=n}function load(n,t){$.ajax({url:n,method:"GET"}).done(function(n,i,r){t?t.html(n):console.log(n,i,r);window.scrollTo(0,0)}).fail(function(n){console.log(n)})}function setupAjaxSubmit(){$("body").on("submit","form",function(n){var t,i,r;if(n.preventDefault(),t=$(this),this.checkValidity()!==!1){if(t.attr("method").toLowerCase()=="get")return i=t.serialize(),r=t.attr("action")+"?"+i,updateHash(r);submitForm(t)}})}function submitForm(n,t,i){var u=n.attr("method")??"POST",r=n.data("target"),f=n.data("replace")??!1;$.ajax({method:u,url:t||n.attr("action"),data:i||n.serialize()}).done(function(n,t,i){if(i&&i.responseJSON)handleJsonResponse(i.responseJSON);else if(n&&r){var u=$(r);f?u.replaceWith(n):u.html(n)}else console.log(n,t,i),loadHash()}).fail(function(n){n&&n.responseJSON?handleJsonResponse(n.responseJSON):(console.log(n),loadHash())})}function handleJsonResponse(n){n.redirect&&(n.redirect=="refresh"?loadHash():updateHash(n.redirect))}ready(setupAnchors);ready(setupHashChange);ready(setupAjaxSubmit);
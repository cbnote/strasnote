!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(r){"use strict";var g,d,l,h,m=";",y="AS",C=r.Pos,A=r.cmpPos;function f(t){return"[object Array]"==Object.prototype.toString.call(t)}function c(t,e){return t.getModeAt(t.getCursor()).config[e]||r.resolveMode("text/x-sql")[e]}function p(t){return"string"==typeof t?t:t.text}function v(t,e){return(e=f(e)?{columns:e}:e).text||(e.text=t),e}function j(t){return g[t.toUpperCase()]}function x(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function a(t,e){var r=t.length,e=p(e).substr(0,r);return t.toUpperCase()===e.toUpperCase()}function b(t,e,r,n){if(f(r))for(var o=0;o<r.length;o++)a(e,r[o])&&t.push(n(r[o]));else for(var i in r){var s;!r.hasOwnProperty(i)||a(e,s=(s=r[i])&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function w(t){for(var e=p(t).split("."),r=0;r<e.length;r++)e[r]=h+e[r].replace(new RegExp(h,"g"),h+h)+h;var n=e.join(".");return"string"==typeof t?n:((t=x(t)).text=n,t)}function q(t,e,r,n){for(var o=!1,i=[],s=e.start,a=!0;a;)a="."==e.string.charAt(0),o=o||e.string.charAt(0)==h,s=e.start,i.unshift(function(t){for(var e=(t="."==t.charAt(0)?t.substr(1):t).split(h+h),r=0;r<e.length;r++)e[r]=e[r].replace(new RegExp(h,"g"),"");return e.join(h)}(e.string)),"."==(e=n.getTokenAt(C(t.line,e.start))).string&&(a=!0,e=n.getTokenAt(C(t.line,e.start)));var u=i.join("."),l=(b(r,u,g,function(t){return o?w(t):t}),b(r,u,d,function(t){return o?w(t):t}),u=i.pop(),i.join(".")),f=!1,c=l,p=(j(l)||(l=U(p=l,n))!==p&&(f=!0),j(l));return(p=p&&p.columns?p.columns:p)&&b(r,u,p,function(t){var e=1==f?c:l;return"string"==typeof t?t=e+"."+t:(t=x(t)).text=e+"."+t.text,o?w(t):t}),s}function U(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),i="",s="",a=[],u={start:C(0,0),end:C(e.lastLine(),e.getLineHandle(e.lastLine()).length)},l=n.indexOf(m);-1!=l;)a.push(r.posFromIndex(l)),l=n.indexOf(m,l+1);a.unshift(C(0,0)),a.push(C(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var f=null,c=e.getCursor(),p=0;p<a.length;p++){if((null==f||0<A(c,f))&&A(c,a[p])<=0){u={start:f,end:a[p]};break}f=a[p]}if(u.start)for(var g=r.getRange(u.start,u.end,!1),p=0;p<g.length;p++){for(var d=g[p],h=(b=x=v=h=void 0,d),v=function(t){var e=t.toUpperCase();e===o&&j(i)&&(s=i),e!==y&&(i=t)},x=h.split(/\s+/),b=0;b<x.length;b++)x[b]&&v(x[b].replace(/[`,;]/g,""));if(s)break}return s}r.registerHelper("hint","sql",function(t,e){g=function(t){var e={};if(f(t))for(var r=t.length-1;0<=r;r--){var n=t[r];e[p(n).toUpperCase()]=v(p(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=v(o,t[o]);return e}(e&&e.tables);var r,n,o,i,s=e&&e.defaultTable,e=e&&e.disableKeywords,s=(d=s&&j(s),l=c(t,"keywords")||[],h=c(t,"identifierQuote")||"`",(d=(d=s&&!d?U(s,t):d)||[]).columns&&(d=d.columns),t.getCursor()),a=[],u=t.getTokenAt(s);return u.end>s.ch&&(u.end=s.ch,u.string=u.string.slice(0,s.ch-u.start)),u.string.match(/^[.`"'\w@][\w$#]*$/g)?(o=u.string,r=u.start,n=u.end):(r=n=s.ch,o=""),"."==o.charAt(0)||o.charAt(0)==h?r=q(s,u,a,t):(i=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t},b(a,o,d,function(t){return i(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),b(a,o,g,function(t){return i(t,"CodeMirror-hint-table")}),e||b(a,o,l,function(t){return i(t.toUpperCase(),"CodeMirror-hint-keyword")})),{list:a,from:C(s.line,r),to:C(s.line,n)}})});